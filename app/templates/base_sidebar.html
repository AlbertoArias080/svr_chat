{% extends "base.html" %}

{% block content %}
<!-- Agregar FontAwesome CDN en el head -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<div class="layout">

    <aside class="sidebar" id="sidebar">
        <div class="brand">
            <button class="hamburger-btn" id="hamburgerBtn">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <span class="full-text">BMC</span>
            <span class="collapsed-text"></span>
        </div>
        <nav>
            <div class="section">
                <span class="full-text">Navegación</span>
            </div>
            <a href="{{ url_for('main.home') }}" class="item" data-tooltip="Volver al Home" data-section-start>
                <span class="icon"><i class="fas fa-home"></i></span>
                <span class="text">Volver al Home</span>
            </a>

            {% if current_user.is_authenticated %}
                {% if current_user.role == 'admin' %}
                    <!-- Opciones solo para administradores -->
                    <div class="section">
                        <span class="full-text">Administración</span>
                    </div>
                    <a href="{{ url_for('admin.dashboard') }}" class="item" data-tooltip="Mi gestión" data-section-start>
                        <span class="icon"><i class="fas fa-chart-bar"></i></span>
                        <span class="text">Mi gestión</span>
                    </a>
                    <a href="{{ url_for('admin.upload_ui') }}" class="item" data-tooltip="Cargar documentos">
                        <span class="icon"><i class="fas fa-upload"></i></span>
                        <span class="text">Cargar documentos</span>
                    </a>
                    <a href="{{ url_for('admin.sync_status') }}" class="item" data-tooltip="Estado sincronización">
                        <span class="icon"><i class="fas fa-sync-alt"></i></span>
                        <span class="text">Estado sincronización</span>
                    </a>
                {% else %}
                    <!-- Opciones para usuarios normales -->
                    <div class="section">
                        <span class="full-text">Tareas</span>
                    </div>
                    <a href="{{ url_for('main.user_chat') }}" class="item" data-tooltip="Chat con Agentes" data-section-start>
                        <span class="icon"><i class="fas fa-comments"></i></span>
                        <span class="text">Chat con Agentes</span>
                    </a>
                {% endif %}
                
                <div class="section">
                    <span class="full-text">Cuenta</span>
                </div>
                <a href="{{ url_for('auth.logout') }}" class="item" data-tooltip="Cerrar sesión" data-section-start>
                    <span class="icon"><i class="fas fa-sign-out-alt"></i></span>
                    <span class="text">Cerrar sesión</span>
                </a>
            {% else %}
                <!-- Opción si el usuario no está autenticado -->
                <div class="section">
                    <span class="full-text">Cuenta</span>
                </div>
                <a href="{{ url_for('auth.login') }}" class="item" data-tooltip="Iniciar sesión" data-section-start>
                    <span class="icon"><i class="fas fa-sign-in-alt"></i></span>
                    <span class="text">Iniciar sesión</span>
                </a>
            {% endif %}
        </nav>
    </aside>

    <section class="content" id="mainContent">
        {% block main %}{% endblock %}
    </section>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const hamburgerBtn = document.getElementById('hamburgerBtn');
    const sidebar = document.getElementById('sidebar');
    
    // Verificar estado guardado
    const isCollapsed = localStorage.getItem('sidebarCollapsed') === 'true';
    
    if (isCollapsed) {
        sidebar.classList.add('collapsed');
        hamburgerBtn.classList.add('active');
        document.body.classList.add('sidebar-collapsed');
    }
    
    hamburgerBtn.addEventListener('click', function() {
        const isNowCollapsed = !sidebar.classList.contains('collapsed');
        
        sidebar.classList.toggle('collapsed');
        hamburgerBtn.classList.toggle('active');
        document.body.classList.toggle('sidebar-collapsed');
        
        // Guardar estado en localStorage
        localStorage.setItem('sidebarCollapsed', isNowCollapsed);
    });
    
    // Cerrar sidebar al hacer clic en un enlace (solo en móviles)
    const sidebarLinks = sidebar.querySelectorAll('.item');
    sidebarLinks.forEach(link => {
        link.addEventListener('click', function() {
            if (window.innerWidth <= 768) {
                sidebar.classList.add('collapsed');
                hamburgerBtn.classList.remove('active');
                document.body.classList.remove('sidebar-collapsed');
                localStorage.setItem('sidebarCollapsed', 'true');
            }
        });
    });
});
</script>
{% endblock %}